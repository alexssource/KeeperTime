<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<html>
<head>
	<title>Untitled</title>
</head>

<body background="../bgrwhite.gif">
<p><div align="center"><b><font size="+1"><i>	
<a name="8-9">Адаптер управления играми</a></i></font></b></div></p>

<p><span
style="mso-spacerun: yes">    </span>Адаптер управления играми подключает к
системе джойстики и другие

<p><span
style="mso-spacerun: yes">    </span>органы управления игрой. Это все
аналоговые устройства - т.е., они

<p><span
style="mso-spacerun: yes">    </span>не могут работать с нулями и единицами. Их
входные значения - это

<p><span
style="mso-spacerun: yes">    </span>сопротивление, которое ЭВМ не может прочитать
непосредственно.

<p><span
style="mso-spacerun: yes">    </span>Адаптер управления играми преобразует
значение сопротивления в

<p><span
style="mso-spacerun: yes">    </span>нечто такое, с чем ЭВМ может иметь дело.

<p><![if !supportEmptyParas]>&nbsp;<![endif]>

<p><span
style='mso-tab-count:1'>      </span>Адаптер управления играми не преобразует
значение сопротивления

<p><span
style="mso-spacerun: yes">    </span>непосредственно в двоичное число. Вместо
этого адаптер преобразует

<p><span
style="mso-spacerun: yes">    </span>значение сопротивления во временную
задержку. Чем больше

<p><span
style="mso-spacerun: yes">    </span>сопротивление, тем больше временная
задержка. Эту задержку

<p><span
style="mso-spacerun: yes">    </span>компьютер может измерить. Преобразовать
задержку в число,

<p><span
style="mso-spacerun: yes">    </span>соответствующее положению джойстика, можно
программным способом.

<p><span
style="mso-spacerun: yes">    </span>Нашей задачей является написание
программы, которая преобразует

<p><span
style="mso-spacerun: yes">    </span>временную задержку в число.

<p><![if !supportEmptyParas]>&nbsp;<![endif]>

<p><span
style='mso-tab-count:1'>      </span>Адаптер управления играми обслуживает до
четырех входов

<p><span
style="mso-spacerun: yes">    </span>сопротивления. Механизм временной задержки
по каждому из этих

<p><span
style="mso-spacerun: yes">    </span>входов подключен к отдельному биту порта
ввода-вывода 201H. Когда

<p><span
style="mso-spacerun: yes">    </span>вы выводите любое число в порт 201H,
четыре его младших бита

<p><span
style="mso-spacerun: yes">    </span>сбрасываются в 0. Биты возвращаются в
состояние 1 после некоторго

<p><span
style="mso-spacerun: yes">    </span>интервала времени. Этот интервал времени
определяется значением

<p><span
style="mso-spacerun: yes">    </span>сопротивления, подключенного к адаптеру.
Программа на Фиг. 8.18 -

<p><span
style="mso-spacerun: yes">    </span>это пример определения значения
сопротивления двух из четырех

<p><span
style="mso-spacerun: yes">    </span>входных портов. Эта программа использует
простой метод. Вместо

<p><span
style="mso-spacerun: yes">    </span>определения временной задержки всех
четырех портов одновременно,

<p><span
style="mso-spacerun: yes">    </span>она обслуживает их последовательно.
Количество времени, нужного для

<p><span
style="mso-spacerun: yes">    </span>определения одной задержки, невелико. В
результате, поочередная

<p><span
style="mso-spacerun: yes">    </span>обработка этих задержек вместо
одновременной выполняется без

<p><span
style="mso-spacerun: yes">    </span>проблем.

<p>

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun:
yes"> </span>Microsoft (R) Macro Assembler Version 5.00<span style='mso-tab-count:
2'>           </span><span style="mso-spacerun: yes">     </span>1/1/80
04:05:57

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun:
yes"> </span>Фиг. 8.18 Адаптер управления играми<span style='mso-tab-count:
3'>                  </span><span style="mso-spacerun: yes">    
</span>Page<span style="mso-spacerun: yes">     </span>1-1

<p><![if !supportEmptyParas]>&nbsp;<![endif]>

<p><span
style='mso-tab-count:7'>                                          </span><span
style="mso-spacerun: yes"> </span>PAGE<span style='mso-tab-count:1'> </span>
,132

<p><span
style='mso-tab-count:7'>                                          </span><span
style="mso-spacerun: yes"> </span>TITLE<span style='mso-tab-count:1'>      </span>
Фиг. 8.18 Адаптер управления играми

<p><![if !supportEmptyParas]>&nbsp;<![endif]>

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>= 0201<span style='mso-tab-count:3'>                </span> GAME_PORT<span
style='mso-tab-count:1'>  </span> EQU<span style='mso-tab-count:1'>  </span>
201H

<p><![if !supportEmptyParas]>&nbsp;<![endif]>

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0000<span style='mso-tab-count:4'>                        </span> STACK<span
style='mso-tab-count:1'>      </span> SEGMENT STACK

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0000<span style='mso-tab-count:1'>      </span>0040[<span
style='mso-tab-count:4'>                   </span> DW<span style='mso-tab-count:
1'>   </span> 64 DUP (?)

<p><span
style='mso-tab-count:3'>                  </span><span style="mso-spacerun:
yes">    </span>????

<p><span
style='mso-tab-count:5'>                              </span><span
style="mso-spacerun: yes">  </span>]

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0080<span style='mso-tab-count:4'>                        </span> STACK<span
style='mso-tab-count:1'>      </span> ENDS

<p><![if !supportEmptyParas]>&nbsp;<![endif]>

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0000<span style='mso-tab-count:4'>                        </span> CODE<span
style='mso-tab-count:1'> </span> SEGMENT

<p><span
style='mso-tab-count:7'>                                          </span><span
style="mso-spacerun: yes"> </span>ASSUME<span style="mso-spacerun: yes"> 
</span>CS:CODE

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0000<span style='mso-tab-count:4'>                        </span>
GAME_CONTROL<span style='mso-tab-count:1'>     </span> PROC<span
style='mso-tab-count:1'> </span> FAR

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0000<span style='mso-tab-count:1'>      </span>1E<span style='mso-tab-count:
4'>                      </span> PUSH<span style='mso-tab-count:1'> </span> DS<span
style='mso-tab-count:2'>         </span> ; Адрес возврата

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0001<span style='mso-tab-count:1'>      </span>2B C0<span
style='mso-tab-count:4'>                   </span> SUB<span style='mso-tab-count:
1'>  </span> AX, AX

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0003<span style='mso-tab-count:1'>      </span>50<span style='mso-tab-count:
4'>                      </span> PUSH<span style='mso-tab-count:1'> </span> AX

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0004<span style='mso-tab-count:1'>      </span>BA 0201 <span
style='mso-tab-count:3'>                </span><span style="mso-spacerun:
yes"> </span>MOV<span style='mso-tab-count:1'>  </span> DX, GAME_PORT

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0007<span style='mso-tab-count:1'>      </span>B8 B000 <span
style='mso-tab-count:3'>                </span><span style="mso-spacerun:
yes"> </span>MOV<span style='mso-tab-count:1'>  </span> AX, 0B000H<span
style='mso-tab-count:1'> </span> ; Сегмент дисплейной памяти

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>000A<span style='mso-tab-count:1'>      </span>8E D8<span
style='mso-tab-count:4'>                   </span> MOV<span style='mso-tab-count:
1'>  </span> DS, AX

<p><![if !supportEmptyParas]>&nbsp;<![endif]>

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>000C<span style='mso-tab-count:1'>      </span>B5 21<span
style='mso-tab-count:4'>                   </span> MOV<span style='mso-tab-count:
1'>  </span> CH, 21H<span style='mso-tab-count:1'>    </span> ; Символ, который
будет записываться в буфер

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>000E<span style='mso-tab-count:1'>      </span>B1 00<span
style='mso-tab-count:4'>                   </span> MOV<span style='mso-tab-count:
1'>  </span> CL, 0

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0010<span style='mso-tab-count:4'>                        </span>
WRITE_LOOP:

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0010<span style='mso-tab-count:1'>      </span>B4 01<span
style='mso-tab-count:4'>                   </span> MOV<span style='mso-tab-count:
1'>  </span> AH, 1<span style='mso-tab-count:2'>            </span> ; Выбор
координаты X

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0012<span style='mso-tab-count:1'>      </span>E8 0042 R<span
style='mso-tab-count:3'>               </span> CALL<span style='mso-tab-count:
1'> </span> POSITION

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0015<span style='mso-tab-count:1'>      </span>8B D8<span
style='mso-tab-count:4'>                   </span> MOV<span style='mso-tab-count:
1'>  </span> BX, AX <span style='mso-tab-count:1'>    </span><span
style="mso-spacerun: yes"> </span>; Сохранение координаты X в буфере

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0017<span style='mso-tab-count:1'>      </span>D1 EB<span
style='mso-tab-count:4'>                   </span> SHR<span style='mso-tab-count:
1'>  </span> BX, 1

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0019<span style='mso-tab-count:1'>      </span>D1 EB<span
style='mso-tab-count:4'>                   </span> SHR<span style='mso-tab-count:
1'>  </span> BX, 1<span style='mso-tab-count:2'>            </span> ; Деление
на 4

<p><![if !supportEmptyParas]>&nbsp;<![endif]>

<p><span
style='mso-tab-count:4'>                        </span><span
style="mso-spacerun: yes"> </span>Фиг. 8.18 Адаптер управления играми (начало)

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>001B<span style='mso-tab-count:1'>      </span>B4 02<span
style='mso-tab-count:4'>                   </span> MOV<span style='mso-tab-count:
1'>  </span> AH, 2<span style='mso-tab-count:2'>            </span> ; Выбор
координаты Y

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>001D<span style='mso-tab-count:1'>      </span>E8 0042 R<span
style='mso-tab-count:3'>               </span> CALL<span style='mso-tab-count:
1'> </span> POSITION

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0020<span style='mso-tab-count:1'>      </span>D0 E8<span
style='mso-tab-count:4'>                   </span> SHR<span style='mso-tab-count:
1'>  </span> AL, 1

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0022<span style='mso-tab-count:1'>      </span>D0 E8<span
style='mso-tab-count:4'>                   </span> SHR<span style='mso-tab-count:
1'>  </span> AL, 1

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0024<span style='mso-tab-count:1'>      </span>D0 E8<span
style='mso-tab-count:4'>                   </span> SHR<span style='mso-tab-count:
1'>  </span> AL, 1

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0026<span style='mso-tab-count:1'>      </span>D0 E8<span
style='mso-tab-count:4'>                   </span> SHR<span style='mso-tab-count:
1'>  </span> AL, 1<span style='mso-tab-count:2'>            </span> ; Деление
на 16

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0028<span style='mso-tab-count:1'>      </span>B4 A0<span
style='mso-tab-count:4'>                   </span> MOV<span style='mso-tab-count:
1'>  </span> AH, 160

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>002A<span style='mso-tab-count:1'>      </span>F6 E4<span
style='mso-tab-count:4'>                   </span> MUL<span style='mso-tab-count:
1'>  </span> AH<span style='mso-tab-count:2'>         </span> ; Преобразование
в смещение в буфере

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>002C<span style='mso-tab-count:1'>      </span>03 D8<span
style='mso-tab-count:4'>                   </span> ADD<span style='mso-tab-count:
1'>  </span> BX, AX

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>002E<span style='mso-tab-count:1'>      </span>88 2F<span
style='mso-tab-count:4'>                   </span> MOV<span style='mso-tab-count:
1'>  </span> [BX], CH<span style='mso-tab-count:1'>   </span> ; Сохранение
символа

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0030<span style='mso-tab-count:1'>      </span>EC<span style='mso-tab-count:
4'>                      </span> IN<span style='mso-tab-count:1'>   </span> AL,
DX

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0031<span style='mso-tab-count:1'>      </span>24 10<span
style='mso-tab-count:4'>                   </span> AND<span style='mso-tab-count:
1'>  </span> AL, 10H

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0033<span style='mso-tab-count:1'>      </span>3A C1<span
style='mso-tab-count:4'>                   </span> CMP<span style='mso-tab-count:
1'>  </span> AL, CL

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0035<span style='mso-tab-count:1'>      </span>74 D9<span
style='mso-tab-count:4'>                   </span> JE<span style='mso-tab-count:
1'>   </span> WRITE_LOOP

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0037<span style='mso-tab-count:1'>      </span>8A C8<span
style='mso-tab-count:4'>                   </span> MOV<span style='mso-tab-count:
1'>  </span> CL, AL

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0039<span style='mso-tab-count:1'>      </span>80 F9 10<span
style='mso-tab-count:3'>                </span> CMP<span style='mso-tab-count:
1'>  </span> CL, 10H

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>003C<span style='mso-tab-count:1'>      </span>75 D2<span
style='mso-tab-count:4'>                   </span> JNE<span style='mso-tab-count:
1'>  </span> WRITE_LOOP

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>003E<span style='mso-tab-count:1'>      </span>FE C5<span
style='mso-tab-count:4'>                   </span> INC<span style='mso-tab-count:
1'>  </span> CH<span style='mso-tab-count:2'>         </span> ; Следующий
символ

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0040<span style='mso-tab-count:1'>      </span>EB CE<span
style='mso-tab-count:4'>                   </span> JMP<span style='mso-tab-count:
1'>  </span> WRITE_LOOP

<p><![if !supportEmptyParas]>&nbsp;<![endif]>

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0042<span style='mso-tab-count:4'>                        </span>
GAME_CONTROL<span style='mso-tab-count:1'>     </span> ENDP

<p><![if !supportEmptyParas]>&nbsp;<![endif]>

<p><span
style='mso-tab-count:6'>                                    </span><span
style="mso-spacerun: yes"> </span>;-----<span style="mso-spacerun: yes"> 
</span>В AH бит маски

<p><![if !supportEmptyParas]>&nbsp;<![endif]>

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0042<span style='mso-tab-count:4'>                        </span>
POSITION<span style='mso-tab-count:1'>   </span> PROC<span style='mso-tab-count:
1'> </span> NEAR

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0042<span style='mso-tab-count:1'>      </span>51<span style='mso-tab-count:
4'>                      </span> PUSH<span style='mso-tab-count:1'> </span> CX

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0043<span style='mso-tab-count:1'>      </span>2B C9<span
style='mso-tab-count:4'>                   </span> SUB<span style='mso-tab-count:
1'>  </span> CX, CX <span style='mso-tab-count:1'>    </span><span
style="mso-spacerun: yes"> </span>; Начальное значение для цикла ввода

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0045<span style='mso-tab-count:1'>      </span>EE<span style='mso-tab-count:
4'>                      </span> OUT<span style='mso-tab-count:1'>  </span> DX,
AL <span style='mso-tab-count:1'>    </span><span style="mso-spacerun:
yes"> </span>; Запуск таймера

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0046<span style='mso-tab-count:4'>                        </span>
POS_LOOP:

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0046<span style='mso-tab-count:1'>      </span>EC<span style='mso-tab-count:
4'>                      </span> IN<span style='mso-tab-count:1'>   </span> AL,
DX

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0047<span style='mso-tab-count:1'>      </span>84 C4<span
style='mso-tab-count:4'>                   </span> TEST<span style='mso-tab-count:
1'> </span> AL, AH

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0049<span style='mso-tab-count:1'>      </span>E0 FB<span
style='mso-tab-count:4'>                   </span> LOOPNE<span
style="mso-spacerun: yes">  </span>POS_LOOP<span style='mso-tab-count:1'> </span>
; Цикл пока 1 - таймер не закончил отсчет

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>004B<span style='mso-tab-count:1'>      </span>B8 0000 <span
style='mso-tab-count:3'>                </span><span style="mso-spacerun:
yes"> </span>MOV<span style='mso-tab-count:1'>  </span> AX, 0

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>004E<span style='mso-tab-count:1'>      </span>2B C1<span
style='mso-tab-count:4'>                   </span> SUB<span style='mso-tab-count:
1'>  </span> AX, CX <span style='mso-tab-count:1'>    </span><span
style="mso-spacerun: yes"> </span>; Определение значения счетчика

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0050<span style='mso-tab-count:1'>      </span>59<span style='mso-tab-count:
4'>                      </span> POP<span style='mso-tab-count:1'>  </span> CX<span
style='mso-tab-count:2'>         </span> ;<span style="mso-spacerun: yes"> 
</span>в диапазоне 0-255

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0051<span style='mso-tab-count:1'>      </span>C3<span style='mso-tab-count:
4'>                      </span> RET

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0052<span style='mso-tab-count:4'>                        </span>
POSITION<span style='mso-tab-count:1'>   </span> ENDP

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes"> 
</span>0052<span style='mso-tab-count:4'>                        </span> CODE<span
style='mso-tab-count:1'> </span> ENDS

<p><span
style='mso-tab-count:7'>                                          </span><span
style="mso-spacerun: yes"> </span>END&#18;

<p><![if !supportEmptyParas]>&nbsp;<![endif]>

<p><span
style='mso-tab-count:2'>            </span><span style="mso-spacerun: yes">   
</span>Фиг. 8.18 Адаптер управления играми (продолжение)

<p><![if !supportEmptyParas]>&nbsp;<![endif]>

<p><span
style='mso-tab-count:1'>      </span>Последняя часть программы на Фиг. 8.18
берет позицию X-Y,

<p><span
style="mso-spacerun: yes">    </span>определенную по входу от джойстика, и
записывает символ в

<p><span
style="mso-spacerun: yes">    </span>соответствующую позицию дисплея. Адаптер
управления играми также

<p><span
style="mso-spacerun: yes">    </span>допускает четыре переключающих ввода,
значения которых можно

<p><span
style="mso-spacerun: yes">    </span>прочитать в старших четырех битах порта
201H. Программа в примере

<p><span
style="mso-spacerun: yes">    </span>опрашивает один из этих битов переключения,
чтобы перейти от одного

<p><span
style="mso-spacerun: yes">    </span>символа к другому и вывести его на экран.

<p><div align="center"><a href="index.html"><img src="../soder.gif" width=120 height=31 border=0 alt=""></a></div></p>

</body>
</html>
